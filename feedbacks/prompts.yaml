visual_qa:
  question_generation:
    prompt_template: |
      Generate {num_questions} visual quality control questions based on the design goal and optionally a reference image. Categorize the questions under ['Geometry Accuracy', 'Dimensional Accuracy', 'Feature Integrity', 'Topological Integrity', 'Symmetry and Alignment']. Ensure each question is clear, specific, and actionable.

      Design Goal:
      {design_goal}

      Reference Image: [attached if provided]
    system_prompt: |
      You are an expert in 3D object quality assurance. Your task is to generate a set of specific, actionable, and categorized visual quality control questions to evaluate the fidelity and accuracy of a rendered object against its design goal. Focus on assessing geometry accuracy, dimensional precision, feature integrity, topological correctness, and symmetry and alignment. Ensure that each question is clear and targets a particular aspect of the object to guide a thorough quality assessment. Use terms like "object" or specific object concepts (e.g., table, chair, cylinder) mentioned in the design goal.
    examples: |
      - description: "Create a table."
        questions:
          - Geometry Accuracy:
              - Does the object resemble a table in terms of its overall shape and structure?
              - Are the legs of the table evenly spaced and proportional to the tabletop?
          - Dimensional Accuracy:
              - Is the height of the table within a reasonable range for a standard table?
              - Is the tabletop large enough to function as a usable surface?
          - Feature Integrity:
              - Does the table have a flat and stable tabletop?
              - Are the legs of the table sturdy and properly attached to the tabletop?
          - Symmetry and Alignment:
              - Are the legs of the table symmetrically placed?
              - Is the tabletop aligned evenly with the legs?
      - description: "Design a rectangular dining table with dimensions 180 cm (length) x 90 cm (width) x 75 cm (height). The table should have four legs, each 5 cm in diameter, placed 20 cm inward from the edges. The tabletop should be 3 cm thick and have rounded edges for safety."
        questions:
          - Geometry Accuracy:
              - Is the tabletop rectangular with dimensions 180 cm x 90 cm?
              - Are the legs cylindrical with a diameter of 5 cm?
          - Dimensional Accuracy:
              - Is the table height exactly 75 cm?
              - Are the legs placed 20 cm inward from the edges of the tabletop?
          - Feature Integrity:
              - Is the tabletop 3 cm thick with rounded edges?
              - Are the legs securely attached to the tabletop without wobbling?
          - Symmetry and Alignment:
              - Are the four legs evenly spaced and aligned with the tabletop?
              - Are the rounded edges uniformly applied across the tabletop?
    counterexamples: |
      - description: "Create a table."
        questions:
          - Color and Finish:
              - Is the table painted in a matte or glossy finish?
              - Does the table have a wood grain texture?
            (These questions are irrelevant to the structural and dimensional accuracy of the table.)
      - description: "Design a rectangular dining table with specific dimensions."
        questions:
          - Material Cost:
              - Is the table made from expensive or affordable materials?
              - How much does the table cost to produce?
            (These questions are irrelevant to the design specifications and visual quality control.)

  answer_generation:
    prompt_template: |
      Answer the following questions based on the design goal and the rendered object images provided. Provide clear and concise answers.

      Design Goal:
      {design_goal}

      Questions:
      {questions}

      Rendered Images: [attached]
    system_prompt: |
      You are an expert in 3D object quality assurance. Your task is to answer the provided questions by analyzing the rendered object images and comparing them to the design goal. Ensure your answers are accurate and based on visual inspection of the images.
    examples: |
      - description: "Create a table."
        questions:
          - Is the overall geometry of the table accurate compared to the design goal?
          - Are the dimensions of the table components within reasonable tolerances?
        answers:
          - The overall geometry of the table is accurate, with a flat tabletop and four legs.
          - The dimensions are within reasonable tolerances, making the table functional and proportional.
      - description: "Design a rectangular dining table with dimensions 180 cm (length) x 90 cm (width) x 75 cm (height). The table should have four legs, each 5 cm in diameter, placed 20 cm inward from the edges. The tabletop should be 3 cm thick and have rounded edges for safety."
        questions:
          - Is the tabletop rectangular with dimensions 180 cm x 90 cm?
          - Are the legs cylindrical with a diameter of 5 cm and placed 20 cm inward from the edges?
          - Is the tabletop 3 cm thick with rounded edges?
        answers:
          - The tabletop is rectangular and measures exactly 180 cm x 90 cm.
          - The legs are cylindrical with a diameter of 5 cm and are correctly placed 20 cm inward from the edges.
          - The tabletop is 3 cm thick and has uniformly rounded edges for safety.
    counterexamples: |
      - description: "Create a table."
        questions:
          - Is the overall geometry of the table accurate compared to the design goal?
          - Are the dimensions of the table components within reasonable tolerances?
        answers:
          - The table looks stylish and modern.
          - The table is made of high-quality wood.
          (These answers are irrelevant as they focus on aesthetics and material rather than geometry and dimensions.)
      - description: "Design a rectangular dining table with specific dimensions."
        questions:
          - Is the tabletop rectangular with dimensions 180 cm x 90 cm?
          - Are the legs cylindrical with a diameter of 5 cm and placed 20 cm inward from the edges?
        answers:
          - The tabletop is rectangular, but the dimensions are not measured.
          - The legs are cylindrical, but their placement is not verified.
          (These answers are incomplete and fail to address the specific requirements of the design goal.)

visual_feedback:
  user_prompt_template: |
    Compare the rendered object with the design goal and reference images (if provided). Focus on the geometry, shape, proportions, alignment, and physical feasibility of the object. Avoid assumptions beyond what is explicitly visible in the rendering. Pay attention to the following:
    - Images are captured in an orthographic view as much as possible, but slight perspective effects may still exist. Do not overinterpret these effects as structural deformation.
    - Each image has a label in the top-right corner indicating the camera's position relative to the object (e.g., front, top, upper-left). Use this information to better analyze the object.
    - The background is intentionally set to white, and all rendered objects are displayed in colors significantly different from white. If a gap or blank space is visible between two parts, it likely indicates improper connection or separation, which may cause structural instability.
    - Check for interferences or overlaps between parts (e.g., parts passing through each other). Such issues may indicate flawed geometry or infeasible assembly.
    - Identify:
      - Hits: Aspects of the rendered object that meet the design specifications.
      - Misses: Aspects of the rendered object that deviate from the design specifications.
      - Suggestions: Actions to address any deviations.

    Design Goal:
    {text}

    Reference Image: [attached if provided]
  system_prompt_template: |
    You are an expert in 3D object quality assurance. Your task is to compare the rendered object with the design goal and reference images. Your analysis must:
    - Focus solely on geometry, shape, proportions, alignment, physical feasibility, and connections between parts.
    - Account for slight perspective effects in the rendering, as the images aim to be orthographic. Do not misinterpret these effects as structural deformations unless strongly evident.
    - Use the camera position labeled in the top-right corner of each image to understand the object's orientation and structure accurately.
    - Check for:
      - Proper connections between parts. If gaps or blank spaces appear between parts, highlight them as potential issues impacting physical stability.
      - Interferences or overlaps between parts (e.g., parts passing through each other). Highlight any such occurrences as potential design flaws.
    - Identify hits (what meets the specifications), misses (what deviates), and provide actionable suggestions for improvement.
    - Ensure feedback is clear, concise, and practical.
  examples:
    - description: "I want a chair with four legs, a curved backrest, and a circular seat."
      feedback: |
        Hits: The chair has four legs and a circular seat, aligning with the design goal.
        Misses: The backrest is not curved as specified. The legs appear unevenly spaced, which may affect stability.
        Suggestions: Adjust the backrest to add curvature and ensure legs are evenly spaced for stability.
    - description: "I want a table with a flat circular top and straight legs, with the top having a radius of 60 units and the legs 45 units in length."
      feedback: |
        Hits: The circular top is consistent with the design goal in shape.
        Misses: The top appears slightly oversized and does not match the specified radius of 60 units. The legs are either missing or not represented adequately. There is also a visible gap between the top and the support structure, which compromises stability.
        Suggestions: Resize the top to the correct radius, add or adjust the legs to meet length specifications, and ensure proper connections between the top and support structure for stability.

feedback_judge:
  is_feedback_better:
    prompt_template: |
      You are evaluating two iterations of a design based on their feedback. The feedback describes how well each iteration aligns with the design goal. Compare the feedback for the current iteration (New Feedback) with the feedback for the previous iteration (Old Feedback) and determine if the current iteration represents an improvement over the previous iteration.

      **Design Goal:**
      {design_goal}

      **Old Feedback (Previous Iteration):**
      {old_feedback}

      **New Feedback (Current Iteration):**
      {new_feedback}

      **Response Format:**
      - **Decision:** Yes/No
      - **Explanation:** [Brief explanation of why the current iteration is better or worse than the previous iteration]
    system_prompt: |
      You are an expert in evaluating design iterations. Your task is to compare two iterations of a design based on their feedback and determine if the current iteration represents an improvement over the previous iteration. Focus on how well each iteration aligns with the design goal, and consider factors such as geometry accuracy, feature integrity, and physical feasibility. Provide a clear and concise explanation for your decision.
    examples: |
      - description: "Compare iterations for a chair design."
        design_goal: "A chair with four legs, a curved backrest, and a circular seat."
        old_feedback: |
          Hits: The chair has four legs and a circular seat.
          Misses: The backrest is not curved as specified. The legs are unevenly spaced.
          Suggestions: Adjust the backrest to add curvature and ensure legs are evenly spaced.
        new_feedback: |
          Hits: The chair has four legs and a circular seat. The backrest is now curved as specified.
          Misses: The legs are still unevenly spaced.
          Suggestions: Ensure legs are evenly spaced for stability.
        response: |
          - **Decision:** Yes
          - **Explanation:** The current iteration improves on the previous iteration by addressing the curved backrest, which was a key design requirement. However, the issue of unevenly spaced legs remains.
      - description: "Compare iterations for a table design."
        design_goal: "A table with a flat circular top and straight legs, with the top having a radius of 60 units and the legs 45 units in length."
        old_feedback: |
          Hits: The circular top is consistent with the design goal in shape.
          Misses: The top appears slightly oversized. The legs are missing.
          Suggestions: Resize the top to the correct radius and add legs.
        new_feedback: |
          Hits: The circular top is consistent with the design goal in shape.
          Misses: The top is still oversized. The legs are now present but are too short.
          Suggestions: Resize the top to the correct radius and adjust the leg length.
        response: |
          - **Decision:** No
          - **Explanation:** The current iteration does not represent an improvement over the previous iteration. While the legs have been added, they are too short, and the top remains oversized. Both issues need to be addressed.

  is_design_goal_achieved:
    prompt_template: |
      Evaluate the following feedback based on the design goal. Determine if the design goal has been achieved and provide a score between 0 and 1 indicating how close the feedback is to the design goal. Use the following format for your response:

      **Design Goal:**
      {design_goal}

      **Feedback:**
      {feedback}

      **Response Format:**
      - **Achieved:** Yes/No
      - **Score:** [Score between 0 and 1]
      - **Explanation:** [Brief explanation of why the design goal has or has not been achieved]
    system_prompt: |
      You are an expert in evaluating design feedback. Your task is to determine if the design goal has been achieved based on the feedback provided. Provide a score between 0 and 1 indicating how close the feedback is to the design goal, along with a clear explanation for your decision.
    examples: |
      - description: "Evaluate feedback for a chair design."
        design_goal: "A chair with four legs, a curved backrest, and a circular seat."
        feedback: |
          Hits: The chair has four legs and a circular seat, aligning with the design goal.
          Misses: The backrest is not curved as specified. The legs appear unevenly spaced, which may affect stability.
          Suggestions: Adjust the backrest to add curvature and ensure legs are evenly spaced for stability.
        response: |
          - **Achieved:** No
          - **Score:** 0.6
          - **Explanation:** The feedback indicates that the chair meets some design specifications (four legs, circular seat) but fails to achieve the curved backrest and has unevenly spaced legs, which are critical aspects of the design goal.
      - description: "Evaluate feedback for a table design."
        design_goal: "A table with a flat circular top and straight legs, with the top having a radius of 60 units and the legs 45 units in length."
        feedback: |
          Hits: The circular top is consistent with the design goal in shape and size. The legs are correctly placed and aligned.
          Misses: None.
          Suggestions: None.
        response: |
          - **Achieved:** Yes
          - **Score:** 1.0
          - **Explanation:** The feedback confirms that all aspects of the design goal have been met, with no misses or suggestions for improvement.
